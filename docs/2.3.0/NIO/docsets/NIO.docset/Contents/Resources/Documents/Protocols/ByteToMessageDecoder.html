<!DOCTYPE html>
<html lang="en">
  <head>
    <title>ByteToMessageDecoder Protocol Reference</title>
    <link rel="stylesheet" type="text/css" href="../css/jazzy.css" />
    <link rel="stylesheet" type="text/css" href="../css/highlight.css" />
    <meta charset="utf-8">
    <script src="../js/jquery.min.js" defer></script>
    <script src="../js/jazzy.js" defer></script>
    
    <script src="../js/lunr.min.js" defer></script>
    <script src="../js/typeahead.jquery.js" defer></script>
    <script src="../js/jazzy.search.js" defer></script>
  </head>
  <body>

    <a name="//apple_ref/swift/Protocol/ByteToMessageDecoder" class="dashAnchor"></a>

    <a title="ByteToMessageDecoder Protocol Reference"></a>

    <header class="header">
      <p class="header-col header-col--primary">
        <a class="header-link" href="../index.html">
          NIO Docs
        </a>
         (90% documented)
      </p>
    
      <p class="header-col--secondary">
        <form role="search" action="../search.json">
          <input type="text" placeholder="Search documentation" data-typeahead>
        </form>
      </p>
    
        <p class="header-col header-col--secondary">
          <a class="header-link" href="https://github.com/apple/swift-nio">
            <img class="header-icon" src="../img/gh.png"/>
            View on GitHub
          </a>
        </p>
    
        <p class="header-col header-col--secondary">
          <a class="header-link" href="dash-feed://https%3A%2F%2Fapple%2Egithub%2Eio%2Fswift%2Dnio%2Fdocs%2F2%2E3%2E0%2Fdocsets%2FNIO%2Exml">
            <img class="header-icon" src="../img/dash.png"/>
            Install in Dash
          </a>
        </p>
    </header>

    <p class="breadcrumbs">
      <a class="breadcrumb" href="../index.html">NIO Reference</a>
      <img class="carat" src="../img/carat.png" />
      ByteToMessageDecoder Protocol Reference
    </p>

    <div class="content-wrapper">
      <nav class="navigation">
        <ul class="nav-groups">
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="../Classes.html">Classes</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Classes/AcceptBackoffHandler.html">AcceptBackoffHandler</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Classes/BackPressureHandler.html">BackPressureHandler</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Classes/ByteToMessageHandler.html">ByteToMessageHandler</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Classes/ChannelHandlerContext.html">ChannelHandlerContext</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Classes/ChannelHandlerContext.html#/s:3NIO21ChannelHandlerContextC12RemovalTokenV">– RemovalToken</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Classes/ChannelPipeline.html">ChannelPipeline</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Classes/ChannelPipeline/Position.html">– Position</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Classes/ClientBootstrap.html">ClientBootstrap</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Classes/DatagramBootstrap.html">DatagramBootstrap</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Classes/EmbeddedChannel.html">EmbeddedChannel</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Classes/EmbeddedChannel/LeftOverState.html">– LeftOverState</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Classes/EmbeddedChannel/BufferState.html">– BufferState</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Classes/EmbeddedChannel/WrongTypeError.html">– WrongTypeError</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Classes/EmbeddedEventLoop.html">EmbeddedEventLoop</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Classes/EventLoopFuture.html">EventLoopFuture</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Classes/IdleStateHandler.html">IdleStateHandler</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Classes/IdleStateHandler/IdleStateEvent.html">– IdleStateEvent</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Classes/MessageToByteHandler.html">MessageToByteHandler</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Classes/MultiThreadedEventLoopGroup.html">MultiThreadedEventLoopGroup</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Classes/NIOCloseOnErrorHandler.html">NIOCloseOnErrorHandler</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Classes/NIOFileHandle.html">NIOFileHandle</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Classes/NIOFileHandle/Mode.html">– Mode</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Classes/NIOFileHandle/Flags.html">– Flags</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Classes/NIONetworkInterface.html">NIONetworkInterface</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Classes/NIOThreadPool.html">NIOThreadPool</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Classes/NIOThreadPool/WorkItemState.html">– WorkItemState</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Classes/RepeatedTask.html">RepeatedTask</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Classes/ServerBootstrap.html">ServerBootstrap</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Classes/ThreadSpecificVariable.html">ThreadSpecificVariable</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="../Enums.html">Enumerations</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Enums/ByteToMessageDecoderError.html">ByteToMessageDecoderError</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Enums/ByteToMessageDecoderError.html#/s:3NIO25ByteToMessageDecoderErrorO015PayloadTooLargeF0V">– PayloadTooLargeError</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Enums/ChannelError.html">ChannelError</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Enums/ChannelEvent.html">ChannelEvent</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Enums/ChannelPipelineError.html">ChannelPipelineError</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Enums/CloseMode.html">CloseMode</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Enums/DecodingState.html">DecodingState</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Enums/Endianness.html">Endianness</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Enums/EventLoopError.html">EventLoopError</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Enums/IOData.html">IOData</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Enums/SocketAddress.html">SocketAddress</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Enums/SocketAddress/IPv4Address.html">– IPv4Address</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Enums/SocketAddress/IPv6Address.html">– IPv6Address</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Enums/SocketAddress/UnixSocketAddress.html">– UnixSocketAddress</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Enums/SocketAddressError.html">SocketAddressError</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Enums/System.html">System</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="../Protocols.html">Protocols</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Protocols/ByteToMessageDecoder.html">ByteToMessageDecoder</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Protocols/Channel.html">Channel</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Protocols/ChannelCore.html">ChannelCore</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Protocols/ChannelHandler.html">ChannelHandler</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Protocols/ChannelInboundHandler.html">ChannelInboundHandler</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Protocols/ChannelInboundInvoker.html">ChannelInboundInvoker</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Protocols.html#/s:3NIO14ChannelInvokerP">ChannelInvoker</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Protocols/ChannelOption.html">ChannelOption</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Protocols/ChannelOutboundHandler.html">ChannelOutboundHandler</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Protocols/ChannelOutboundInvoker.html">ChannelOutboundInvoker</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Protocols/EventLoop.html">EventLoop</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Protocols/EventLoopGroup.html">EventLoopGroup</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Protocols/FileDescriptor.html">FileDescriptor</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Protocols/MessageToByteEncoder.html">MessageToByteEncoder</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Protocols/MulticastChannel.html">MulticastChannel</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Protocols/RecvByteBufferAllocator.html">RecvByteBufferAllocator</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Protocols/RemovableChannelHandler.html">RemovableChannelHandler</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Protocols/Resolver.html">Resolver</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Protocols/SocketOptionProvider.html">SocketOptionProvider</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Protocols/WriteObservingByteToMessageDecoder.html">WriteObservingByteToMessageDecoder</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Protocols/_ChannelInboundHandler.html">_ChannelInboundHandler</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Protocols/_ChannelOutboundHandler.html">_ChannelOutboundHandler</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Protocols/_EmittingChannelHandler.html">_EmittingChannelHandler</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="../Structs.html">Structures</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Structs/AdaptiveRecvByteBufferAllocator.html">AdaptiveRecvByteBufferAllocator</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Structs/AddressedEnvelope.html">AddressedEnvelope</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Structs/AllocatorOption.html">AllocatorOption</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Structs/AllowRemoteHalfClosureOption.html">AllowRemoteHalfClosureOption</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Structs/AutoReadOption.html">AutoReadOption</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Structs/BacklogOption.html">BacklogOption</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Structs/ByteBuffer.html">ByteBuffer</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Structs/ByteBufferAllocator.html">ByteBufferAllocator</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Structs/ByteBufferView.html">ByteBufferView</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Structs/ChannelOptions.html">ChannelOptions</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Structs/ChannelOptions/Storage.html">– Storage</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Structs/ChannelShouldQuiesceEvent.html">ChannelShouldQuiesceEvent</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Structs/CircularBuffer.html">CircularBuffer</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Structs/CircularBuffer/Index.html">– Index</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Structs/ConnectTimeoutOption.html">ConnectTimeoutOption</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Structs/DatagramVectorReadMessageCountOption.html">DatagramVectorReadMessageCountOption</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Structs/EventLoopIterator.html">EventLoopIterator</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Structs/EventLoopPromise.html">EventLoopPromise</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Structs/FileRegion.html">FileRegion</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Structs/FixedSizeRecvByteBufferAllocator.html">FixedSizeRecvByteBufferAllocator</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Structs/IOError.html">IOError</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Structs/IOError/FailureDescription.html">– FailureDescription</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Structs/MarkedCircularBuffer.html">MarkedCircularBuffer</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Structs/MaxMessagesPerReadOption.html">MaxMessagesPerReadOption</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Structs/NIOAny.html">NIOAny</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Structs/NIOConnectionError.html">NIOConnectionError</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Structs/NIODeadline.html">NIODeadline</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Structs.html#/s:3NIO36NIOFailedToSetSocketNonBlockingErrorV">NIOFailedToSetSocketNonBlockingError</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Structs/NonBlockingFileIO.html">NonBlockingFileIO</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Structs/NonBlockingFileIO/Error.html">– Error</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Structs/RecvAllocatorOption.html">RecvAllocatorOption</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Structs/Scheduled.html">Scheduled</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Structs/SingleConnectionFailure.html">SingleConnectionFailure</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Structs/SocketOption.html">SocketOption</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Structs/TimeAmount.html">TimeAmount</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Structs/WriteBufferWaterMark.html">WriteBufferWaterMark</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Structs/WriteBufferWaterMarkOption.html">WriteBufferWaterMarkOption</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Structs/WriteSpinOption.html">WriteSpinOption</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="../Typealiases.html">Type Aliases</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Typealiases.html#/s:3NIO20ChannelDuplexHandlera">ChannelDuplexHandler</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Typealiases.html#/SocketOptionLevel">SocketOptionLevel</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Typealiases.html#/s:3NIO17SocketOptionLevela">SocketOptionLevel</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Typealiases.html#/s:3NIO16SocketOptionNamea">SocketOptionName</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Typealiases.html#/SocketOptionValue">SocketOptionValue</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="../Typealiases.html#/s:3NIO17SocketOptionValuea">SocketOptionValue</a>
              </li>
            </ul>
          </li>
        </ul>
      </nav>
      <article class="main-content">

        <section class="section">
          <div class="section-content">
            <h1>ByteToMessageDecoder</h1>
              <div class="declaration">
                <div class="language">
                  <pre class="highlight swift"><code><span class="kd">public</span> <span class="kd">protocol</span> <span class="kt">ByteToMessageDecoder</span></code></pre>

                </div>
              </div>
            <p><code>ByteToMessageDecoder</code>s decode bytes in a stream-like fashion from <code><a href="../Structs/ByteBuffer.html">ByteBuffer</a></code> to another message type.</p>
<h3 id='purpose' class='heading'>Purpose</h3>

<p>A <code>ByteToMessageDecoder</code> provides a simplified API for handling streams of incoming data that can be broken
up into messages. This API boils down to two methods: <code>decode</code>, and <code>decodeLast</code>. These two methods, when
implemented, will be used by a <code><a href="../Classes/ByteToMessageHandler.html">ByteToMessageHandler</a></code> paired with a <code>ByteToMessageDecoder</code> to decode the
incoming byte stream into a sequence of messages.</p>

<p>The reason this helper exists is to smooth away some of the boilerplate and edge case handling code that
is often necessary when implementing parsers in a SwiftNIO <code><a href="../Classes/ChannelPipeline.html">ChannelPipeline</a></code>. A <code>ByteToMessageDecoder</code>
never needs to worry about how inbound bytes will be buffered, as <code><a href="../Classes/ByteToMessageHandler.html">ByteToMessageHandler</a></code> deals with that
automatically. A <code>ByteToMessageDecoder</code> also never needs to worry about memory exclusivity violations
that can occur when re-entrant <code><a href="../Classes/ChannelPipeline.html">ChannelPipeline</a></code> operations occur, as <code><a href="../Classes/ByteToMessageHandler.html">ByteToMessageHandler</a></code> will deal with
those as well.</p>
<h3 id='implementing-bytetomessagedecoder' class='heading'>Implementing ByteToMessageDecoder</h3>

<p>A type that implements <code>ByteToMessageDecoder</code> must implement two methods: <code>decode</code> and <code>decodeLast</code>.</p>

<p><code>decode</code> is the main decoding method, and is the one that will be called most often. <code>decode</code> is invoked
whenever data is received by the wrapping <code><a href="../Classes/ByteToMessageHandler.html">ByteToMessageHandler</a></code>. It is invoked with a <code><a href="../Structs/ByteBuffer.html">ByteBuffer</a></code> containing
all the received data (including any data previously buffered), as well as a <code><a href="../Classes/ChannelHandlerContext.html">ChannelHandlerContext</a></code> that can be
used in the <code>decode</code> function.</p>

<p><code>decode</code> is called in a loop by the <code><a href="../Classes/ByteToMessageHandler.html">ByteToMessageHandler</a></code>. This loop continues until one of two cases occurs:</p>

<ol>
<li>The input <code><a href="../Structs/ByteBuffer.html">ByteBuffer</a></code> has no more readable bytes (i.e. <code>.readableBytes == 0</code>); OR</li>
<li>The <code>decode</code> method returns <code>.needMoreData</code>.</li>
</ol>

<p>The reason this method is invoked in a loop is to ensure that the stream-like properties of inbound data are
respected. It is entirely possible for <code>ByteToMessageDecoder</code> to receive either fewer bytes than a single message,
or multiple messages in one go. Rather than have the <code>ByteToMessageDecoder</code> handle all of the complexity of this,
the logic can be boiled down to a single choice: has the <code>ByteToMessageDecoder</code> been able to move the state forward
or not? If it has, rather than containing an internal loop it may simply return <code>.continue</code> in order to request that
<code>decode</code> be invoked again immediately. If it has not, it can return <code>.needMoreData</code> to ask to be left alone until more
data has been returned from the network.</p>

<p>Essentially, if the next parsing step could not be taken because there wasn&rsquo;t enough data available, return <code>.needMoreData</code>.
Otherwise, return <code>.continue</code>. This will allow a <code>ByteToMessageDecoder</code> implementation to ignore the awkward way data
arrives from the network, and to just treat it as a series of <code>decode</code> calls.</p>

<p><code>decodeLast</code> is a cousin of <code>decode</code>. It is also called in a loop, but unlike with <code>decode</code> this loop will only ever
occur once: when the <code><a href="../Classes/ChannelHandlerContext.html">ChannelHandlerContext</a></code> belonging to this <code>ByteToMessageDecoder</code> is about to become invalidated.
This invalidation happens in two situations: when EOF is received from the network, or when the <code>ByteToMessageDecoder</code>
is being removed from the <code><a href="../Classes/ChannelPipeline.html">ChannelPipeline</a></code>. The distinction between these two states is captured by the value of
<code>seenEOF</code>.</p>

<p>In this condition, the <code>ByteToMessageDecoder</code> must now produce any final messages it can with the bytes it has
available. In protocols where EOF is used as a message delimiter, having <code>decodeLast</code> called with <code>seenEOF == true</code>
may produce further messages. In other cases, <code>decodeLast</code> may choose to deliver any buffered bytes as <q>leftovers</q>,
either in error messages or via <code>channelRead</code>. This can occur if, for example, a protocol upgrade is occurring.</p>

<p>As with <code>decode</code>, <code>decodeLast</code> is invoked in a loop. This allows the same simplification as <code>decode</code> allows: when
a message is completely parsed, the <code>decodeLast</code> function can return <code>.continue</code> and be re-invoked from the top,
rather than containing an internal loop.</p>

<p>Note that the value of <code>seenEOF</code> may change between calls to <code>decodeLast</code> in some rare situations.</p>
<h3 id='implementers-notes' class='heading'>Implementers Notes</h3>

<p>/// <code><a href="../Classes/ByteToMessageHandler.html">ByteToMessageHandler</a></code> will turn your <code>ByteToMessageDecoder</code> into a <code><a href="../Protocols/ChannelInboundHandler.html">ChannelInboundHandler</a></code>. <code><a href="../Classes/ByteToMessageHandler.html">ByteToMessageHandler</a></code>
also solves a couple of tricky issues for you. Most importantly, in a <code>ByteToMessageDecoder</code> you do <em>not</em> need to
worry about re-entrancy. Your code owns the passed-in <code><a href="../Structs/ByteBuffer.html">ByteBuffer</a></code> for the duration of the <code>decode</code>/<code>decodeLast</code> call and
can modify it at will.</p>

<p>If a custom frame decoder is required, then one needs to be careful when implementing
one with <code>ByteToMessageDecoder</code>. Ensure there are enough bytes in the buffer for a
complete frame by checking <code>buffer.readableBytes</code>. If there are not enough bytes
for a complete frame, return without modifying the reader index to allow more bytes to arrive.</p>

<p>To check for complete frames without modifying the reader index, use methods like <code>buffer.getInteger</code>.
You  <em>MUST</em> use the reader index when using methods like <code>buffer.getInteger</code>.
For example calling <code>buffer.getInteger(at: 0)</code> is assuming the frame starts at the beginning of the buffer, which
is not always the case. Use <code>buffer.getInteger(at: buffer.readerIndex)</code> instead.</p>

<p>If you move the reader index forward, either manually or by using one of <code>buffer.read*</code> methods, you must ensure
that you no longer need to see those bytes again as they will not be returned to you the next time <code>decode</code> is
called. If you still need those bytes to come back, consider taking a local copy of buffer inside the function to
perform your read operations on.</p>

<p>The <code><a href="../Structs/ByteBuffer.html">ByteBuffer</a></code> passed in as <code>buffer</code> is a slice of a larger buffer owned by the <code>ByteToMessageDecoder</code>
implementation. Some aspects of this buffer are preserved across calls to <code>decode</code>, meaning that any changes to
those properties you make in your <code>decode</code> method will be reflected in the next call to decode. In particular,
moving the reader index forward persists across calls. When your method returns, if the reader index has advanced,
those bytes are considered <q>consumed</q> and will not be available in future calls to <code>decode</code>.
Please note, however, that the numerical value of the <code>readerIndex</code> itself is not preserved, and may not be the same
from one call to the next. Please do not rely on this numerical value: if you need
to recall where a byte is relative to the <code>readerIndex</code>, use an offset rather than an absolute value.</p>
<h3 id='using-bytetomessagedecoder' class='heading'>Using ByteToMessageDecoder</h3>

<p>To add a <code>ByteToMessageDecoder</code> to the <code><a href="../Classes/ChannelPipeline.html">ChannelPipeline</a></code> use</p>
<pre class="highlight swift"><code><span class="n">channel</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="nf">addHandler</span><span class="p">(</span><span class="kt">ByteToMessageHandler</span><span class="p">(</span><span class="kt">MyByteToMessageDecoder</span><span class="p">()))</span>
</code></pre>

          </div>
        </section>

        <section class="section">
          <div class="section-content">
            <div class="task-group">
              <ul class="item-container">
                <li class="item">
                  <div>
                    <code>
                    <a name="/s:3NIO20ByteToMessageDecoderP10InboundOutQa"></a>
                    <a name="//apple_ref/swift/Alias/InboundOut" class="dashAnchor"></a>
                    <a class="token" href="#/s:3NIO20ByteToMessageDecoderP10InboundOutQa">InboundOut</a>
                    </code>
                  </div>
                  <div class="height-container">
                    <div class="pointer-container"></div>
                    <section class="section">
                      <div class="pointer"></div>
                      <div class="abstract">
                        <p>The type of the messages this <code>ByteToMessageDecoder</code> decodes to.</p>

                      </div>
                      <div class="declaration">
                        <h4>Declaration</h4>
                        <div class="language">
                          <p class="aside-title">Swift</p>
                          <pre class="highlight swift"><code><span class="kd">associatedtype</span> <span class="kt">InboundOut</span></code></pre>

                        </div>
                      </div>
                      <div class="slightly-smaller">
                        <a href="https://github.com/apple/swift-nio/tree/2.3.0/Sources/NIO/Codec.swift#L143">Show on GitHub</a>
                      </div>
                    </section>
                  </div>
                </li>
                <li class="item">
                  <div>
                    <code>
                    <a name="/s:3NIO20ByteToMessageDecoderP6decode7context6bufferAA13DecodingStateOAA21ChannelHandlerContextC_AA0B6BufferVztKF"></a>
                    <a name="//apple_ref/swift/Method/decode(context:buffer:)" class="dashAnchor"></a>
                    <a class="token" href="#/s:3NIO20ByteToMessageDecoderP6decode7context6bufferAA13DecodingStateOAA21ChannelHandlerContextC_AA0B6BufferVztKF">decode(context:buffer:)</a>
                    </code>
                  </div>
                  <div class="height-container">
                    <div class="pointer-container"></div>
                    <section class="section">
                      <div class="pointer"></div>
                      <div class="abstract">
                        <p>Decode from a <code><a href="../Structs/ByteBuffer.html">ByteBuffer</a></code>.</p>

<p>This method will be called in a loop until either the input <code><a href="../Structs/ByteBuffer.html">ByteBuffer</a></code> has nothing to read left or
<code><a href="../Enums/DecodingState.html#/s:3NIO13DecodingStateO12needMoreDatayA2CmF">DecodingState.needMoreData</a></code> is returned. If <code><a href="../Enums/DecodingState.html#/s:3NIO13DecodingStateO8continueyA2CmF">DecodingState.continue</a></code> is returned and the <code><a href="../Structs/ByteBuffer.html">ByteBuffer</a></code>
contains more readable bytes, this method will immediately be invoked again, unless <code>decodeLast</code> needs
to be invoked instead.</p>

                      </div>
                      <div class="declaration">
                        <h4>Declaration</h4>
                        <div class="language">
                          <p class="aside-title">Swift</p>
                          <pre class="highlight swift"><code><span class="k">mutating</span> <span class="kd">func</span> <span class="nf">decode</span><span class="p">(</span><span class="nv">context</span><span class="p">:</span> <span class="kt"><a href="../Classes/ChannelHandlerContext.html">ChannelHandlerContext</a></span><span class="p">,</span> <span class="nv">buffer</span><span class="p">:</span> <span class="k">inout</span> <span class="kt"><a href="../Structs/ByteBuffer.html">ByteBuffer</a></span><span class="p">)</span> <span class="k">throws</span> <span class="o">-&gt;</span> <span class="kt"><a href="../Enums/DecodingState.html">DecodingState</a></span></code></pre>

                        </div>
                      </div>
                      <div>
                        <h4>Parameters</h4>
                        <table class="graybox">
                          <tbody>
                            <tr>
                              <td>
                                <code>
                                <em>context</em>
                                </code>
                              </td>
                              <td>
                                <div>
                                  <p>The <code><a href="../Classes/ChannelHandlerContext.html">ChannelHandlerContext</a></code> which this <code>ByteToMessageDecoder</code> belongs to.</p>
                                </div>
                              </td>
                            </tr>
                            <tr>
                              <td>
                                <code>
                                <em>buffer</em>
                                </code>
                              </td>
                              <td>
                                <div>
                                  <p>The <code><a href="../Structs/ByteBuffer.html">ByteBuffer</a></code> from which we decode.</p>
                                </div>
                              </td>
                            </tr>
                          </tbody>
                        </table>
                      </div>
                      <div>
                        <h4>Return Value</h4>
                        <p><code><a href="../Enums/DecodingState.html#/s:3NIO13DecodingStateO8continueyA2CmF">DecodingState.continue</a></code> if we should continue calling this method or <code><a href="../Enums/DecodingState.html#/s:3NIO13DecodingStateO12needMoreDatayA2CmF">DecodingState.needMoreData</a></code> if it should be called
       again once more data is present in the <code><a href="../Structs/ByteBuffer.html">ByteBuffer</a></code>.</p>
                      </div>
                      <div class="slightly-smaller">
                        <a href="https://github.com/apple/swift-nio/tree/2.3.0/Sources/NIO/Codec.swift#L157">Show on GitHub</a>
                      </div>
                    </section>
                  </div>
                </li>
                <li class="item">
                  <div>
                    <code>
                    <a name="/s:3NIO20ByteToMessageDecoderP10decodeLast7context6buffer7seenEOFAA13DecodingStateOAA21ChannelHandlerContextC_AA0B6BufferVzSbtKF"></a>
                    <a name="//apple_ref/swift/Method/decodeLast(context:buffer:seenEOF:)" class="dashAnchor"></a>
                    <a class="token" href="#/s:3NIO20ByteToMessageDecoderP10decodeLast7context6buffer7seenEOFAA13DecodingStateOAA21ChannelHandlerContextC_AA0B6BufferVzSbtKF">decodeLast(context:buffer:seenEOF:)</a>
                    </code>
                  </div>
                  <div class="height-container">
                    <div class="pointer-container"></div>
                    <section class="section">
                      <div class="pointer"></div>
                      <div class="abstract">
                        <p>Decode from a <code><a href="../Structs/ByteBuffer.html">ByteBuffer</a></code> when no more data is incoming and the <code>ByteToMessageDecoder</code> is about to leave
the pipeline.</p>

<p>This method is called in a loop only once, when the <code><a href="../Classes/ChannelHandlerContext.html">ChannelHandlerContext</a></code> goes inactive (i.e. when <code>channelInactive</code> is fired or
the <code>ByteToMessageDecoder</code> is removed from the pipeline).</p>

<p>Like with <code>decode</code>, this method will be called in a loop until either <code><a href="../Enums/DecodingState.html#/s:3NIO13DecodingStateO12needMoreDatayA2CmF">DecodingState.needMoreData</a></code> is returned from the method
or until the input <code><a href="../Structs/ByteBuffer.html">ByteBuffer</a></code> has no more readable bytes. If <code><a href="../Enums/DecodingState.html#/s:3NIO13DecodingStateO8continueyA2CmF">DecodingState.continue</a></code> is returned and the <code><a href="../Structs/ByteBuffer.html">ByteBuffer</a></code>
contains more readable bytes, this method will immediately be invoked again.</p>

                      </div>
                      <div class="declaration">
                        <h4>Declaration</h4>
                        <div class="language">
                          <p class="aside-title">Swift</p>
                          <pre class="highlight swift"><code><span class="k">mutating</span> <span class="kd">func</span> <span class="nf">decodeLast</span><span class="p">(</span><span class="nv">context</span><span class="p">:</span> <span class="kt"><a href="../Classes/ChannelHandlerContext.html">ChannelHandlerContext</a></span><span class="p">,</span> <span class="nv">buffer</span><span class="p">:</span> <span class="k">inout</span> <span class="kt"><a href="../Structs/ByteBuffer.html">ByteBuffer</a></span><span class="p">,</span> <span class="nv">seenEOF</span><span class="p">:</span> <span class="kt">Bool</span><span class="p">)</span> <span class="k">throws</span> <span class="o">-&gt;</span> <span class="kt"><a href="../Enums/DecodingState.html">DecodingState</a></span></code></pre>

                        </div>
                      </div>
                      <div>
                        <h4>Parameters</h4>
                        <table class="graybox">
                          <tbody>
                            <tr>
                              <td>
                                <code>
                                <em>context</em>
                                </code>
                              </td>
                              <td>
                                <div>
                                  <p>The <code><a href="../Classes/ChannelHandlerContext.html">ChannelHandlerContext</a></code> which this <code>ByteToMessageDecoder</code> belongs to.</p>
                                </div>
                              </td>
                            </tr>
                            <tr>
                              <td>
                                <code>
                                <em>buffer</em>
                                </code>
                              </td>
                              <td>
                                <div>
                                  <p>The <code><a href="../Structs/ByteBuffer.html">ByteBuffer</a></code> from which we decode.</p>
                                </div>
                              </td>
                            </tr>
                            <tr>
                              <td>
                                <code>
                                <em>seenEOF</em>
                                </code>
                              </td>
                              <td>
                                <div>
                                  <p><code>true</code> if EOF has been seen. Usually if this is <code>false</code> the handler has been removed.</p>
                                </div>
                              </td>
                            </tr>
                          </tbody>
                        </table>
                      </div>
                      <div>
                        <h4>Return Value</h4>
                        <p><code><a href="../Enums/DecodingState.html#/s:3NIO13DecodingStateO8continueyA2CmF">DecodingState.continue</a></code> if we should continue calling this method or <code><a href="../Enums/DecodingState.html#/s:3NIO13DecodingStateO12needMoreDatayA2CmF">DecodingState.needMoreData</a></code> if it should be called
       again when more data is present in the <code><a href="../Structs/ByteBuffer.html">ByteBuffer</a></code>.</p>
                      </div>
                      <div class="slightly-smaller">
                        <a href="https://github.com/apple/swift-nio/tree/2.3.0/Sources/NIO/Codec.swift#L175">Show on GitHub</a>
                      </div>
                    </section>
                  </div>
                </li>
                <li class="item">
                  <div>
                    <code>
                    <a name="/s:3NIO20ByteToMessageDecoderP14decoderRemoved7contextyAA21ChannelHandlerContextC_tF"></a>
                    <a name="//apple_ref/swift/Method/decoderRemoved(context:)" class="dashAnchor"></a>
                    <a class="token" href="#/s:3NIO20ByteToMessageDecoderP14decoderRemoved7contextyAA21ChannelHandlerContextC_tF">decoderRemoved(context:)</a>
                    </code>
                      <span class="declaration-note">
                        Default implementation
                      </span>
                  </div>
                  <div class="height-container">
                    <div class="pointer-container"></div>
                    <section class="section">
                      <div class="pointer"></div>
                      <div class="abstract">
                        <p>Called once this <code>ByteToMessageDecoder</code> is removed from the <code><a href="../Classes/ChannelPipeline.html">ChannelPipeline</a></code>.</p>

                      </div>
                      <h4>Default Implementation</h4>
                      <div class="default_impl abstract">
                        
                      </div>
                      <div class="declaration">
                        <h4>Declaration</h4>
                        <div class="language">
                          <p class="aside-title">Swift</p>
                          <pre class="highlight swift"><code><span class="k">mutating</span> <span class="kd">func</span> <span class="nf">decoderRemoved</span><span class="p">(</span><span class="nv">context</span><span class="p">:</span> <span class="kt"><a href="../Classes/ChannelHandlerContext.html">ChannelHandlerContext</a></span><span class="p">)</span></code></pre>

                        </div>
                      </div>
                      <div>
                        <h4>Parameters</h4>
                        <table class="graybox">
                          <tbody>
                            <tr>
                              <td>
                                <code>
                                <em>context</em>
                                </code>
                              </td>
                              <td>
                                <div>
                                  <p>The <code><a href="../Classes/ChannelHandlerContext.html">ChannelHandlerContext</a></code> which this <code>ByteToMessageDecoder</code> belongs to.</p>
                                </div>
                              </td>
                            </tr>
                          </tbody>
                        </table>
                      </div>
                      <div class="slightly-smaller">
                        <a href="https://github.com/apple/swift-nio/tree/2.3.0/Sources/NIO/Codec.swift#L181">Show on GitHub</a>
                      </div>
                    </section>
                  </div>
                </li>
                <li class="item">
                  <div>
                    <code>
                    <a name="/s:3NIO20ByteToMessageDecoderP12decoderAdded7contextyAA21ChannelHandlerContextC_tF"></a>
                    <a name="//apple_ref/swift/Method/decoderAdded(context:)" class="dashAnchor"></a>
                    <a class="token" href="#/s:3NIO20ByteToMessageDecoderP12decoderAdded7contextyAA21ChannelHandlerContextC_tF">decoderAdded(context:)</a>
                    </code>
                      <span class="declaration-note">
                        Default implementation
                      </span>
                  </div>
                  <div class="height-container">
                    <div class="pointer-container"></div>
                    <section class="section">
                      <div class="pointer"></div>
                      <div class="abstract">
                        <p>Called when this <code>ByteToMessageDecoder</code> is added to the <code><a href="../Classes/ChannelPipeline.html">ChannelPipeline</a></code>.</p>

                      </div>
                      <h4>Default Implementation</h4>
                      <div class="default_impl abstract">
                        
                      </div>
                      <div class="declaration">
                        <h4>Declaration</h4>
                        <div class="language">
                          <p class="aside-title">Swift</p>
                          <pre class="highlight swift"><code><span class="k">mutating</span> <span class="kd">func</span> <span class="nf">decoderAdded</span><span class="p">(</span><span class="nv">context</span><span class="p">:</span> <span class="kt"><a href="../Classes/ChannelHandlerContext.html">ChannelHandlerContext</a></span><span class="p">)</span></code></pre>

                        </div>
                      </div>
                      <div>
                        <h4>Parameters</h4>
                        <table class="graybox">
                          <tbody>
                            <tr>
                              <td>
                                <code>
                                <em>context</em>
                                </code>
                              </td>
                              <td>
                                <div>
                                  <p>The <code><a href="../Classes/ChannelHandlerContext.html">ChannelHandlerContext</a></code> which this <code>ByteToMessageDecoder</code> belongs to.</p>
                                </div>
                              </td>
                            </tr>
                          </tbody>
                        </table>
                      </div>
                      <div class="slightly-smaller">
                        <a href="https://github.com/apple/swift-nio/tree/2.3.0/Sources/NIO/Codec.swift#L187">Show on GitHub</a>
                      </div>
                    </section>
                  </div>
                </li>
                <li class="item">
                  <div>
                    <code>
                    <a name="/s:3NIO20ByteToMessageDecoderP18shouldReclaimBytes6bufferSbAA0B6BufferV_tF"></a>
                    <a name="//apple_ref/swift/Method/shouldReclaimBytes(buffer:)" class="dashAnchor"></a>
                    <a class="token" href="#/s:3NIO20ByteToMessageDecoderP18shouldReclaimBytes6bufferSbAA0B6BufferV_tF">shouldReclaimBytes(buffer:)</a>
                    </code>
                      <span class="declaration-note">
                        Default implementation
                      </span>
                  </div>
                  <div class="height-container">
                    <div class="pointer-container"></div>
                    <section class="section">
                      <div class="pointer"></div>
                      <div class="abstract">
                        <p>Determine if the read bytes in the given <code><a href="../Structs/ByteBuffer.html">ByteBuffer</a></code> should be reclaimed and their associated memory freed.
Be aware that reclaiming memory may involve memory copies and so is not free.</p>

<ul>
<li>return: <code>true</code> if memory should be reclaimed, <code>false</code> otherwise.</li>
</ul>

                      </div>
                      <h4>Default Implementation</h4>
                      <div class="default_impl abstract">
                        <p>Default implementation to detect once bytes should be reclaimed.</p>

                      </div>
                      <div class="declaration">
                        <h4>Declaration</h4>
                        <div class="language">
                          <p class="aside-title">Swift</p>
                          <pre class="highlight swift"><code><span class="k">mutating</span> <span class="kd">func</span> <span class="nf">shouldReclaimBytes</span><span class="p">(</span><span class="nv">buffer</span><span class="p">:</span> <span class="kt"><a href="../Structs/ByteBuffer.html">ByteBuffer</a></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span></code></pre>

                        </div>
                      </div>
                      <div>
                        <h4>Parameters</h4>
                        <table class="graybox">
                          <tbody>
                            <tr>
                              <td>
                                <code>
                                <em>buffer</em>
                                </code>
                              </td>
                              <td>
                                <div>
                                  <p>The <code><a href="../Structs/ByteBuffer.html">ByteBuffer</a></code> to check</p>
                                </div>
                              </td>
                            </tr>
                          </tbody>
                        </table>
                      </div>
                      <div class="slightly-smaller">
                        <a href="https://github.com/apple/swift-nio/tree/2.3.0/Sources/NIO/Codec.swift#L195">Show on GitHub</a>
                      </div>
                    </section>
                  </div>
                </li>
              </ul>
            </div>
            <div class="task-group">
              <ul class="item-container">
                <li class="item">
                  <div>
                    <code>
                    <a name="/s:3NIO20ByteToMessageDecoderPAAE14wrapInboundOutyAA6NIOAnyV0gH0QzF"></a>
                    <a name="//apple_ref/swift/Method/wrapInboundOut(_:)" class="dashAnchor"></a>
                    <a class="token" href="#/s:3NIO20ByteToMessageDecoderPAAE14wrapInboundOutyAA6NIOAnyV0gH0QzF">wrapInboundOut(_:)</a>
                    </code>
                      <span class="declaration-note">
                        Extension method
                      </span>
                  </div>
                  <div class="height-container">
                    <div class="pointer-container"></div>
                    <section class="section">
                      <div class="pointer"></div>
                      <div class="abstract">
                        <p>Undocumented</p>

                      </div>
                      <div class="declaration">
                        <h4>Declaration</h4>
                        <div class="language">
                          <p class="aside-title">Swift</p>
                          <pre class="highlight swift"><code><span class="kd">public</span> <span class="kd">func</span> <span class="nf">wrapInboundOut</span><span class="p">(</span><span class="n">_</span> <span class="nv">value</span><span class="p">:</span> <span class="kt"><a href="../Protocols/ByteToMessageDecoder.html#/s:3NIO20ByteToMessageDecoderP10InboundOutQa">InboundOut</a></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt"><a href="../Structs/NIOAny.html">NIOAny</a></span></code></pre>

                        </div>
                      </div>
                      <div class="slightly-smaller">
                        <a href="https://github.com/apple/swift-nio/tree/2.3.0/Sources/NIO/Codec.swift#L234-L236">Show on GitHub</a>
                      </div>
                    </section>
                  </div>
                </li>
              </ul>
            </div>
          </div>
        </section>

      </article>
    </div>
    <section class="footer">
      <p>&copy; 2019 <a class="link" href="https://github.com/apple/swift-nio" target="_blank" rel="external">SwiftNIO Team</a>. All rights reserved. (Last updated: 2019-06-19)</p>
      <p>Generated by <a class="link" href="https://github.com/realm/jazzy" target="_blank" rel="external">jazzy ♪♫ v0.9.4</a>, a <a class="link" href="https://realm.io" target="_blank" rel="external">Realm</a> project.</p>
    </section>
  </body>
</div>
</html>
